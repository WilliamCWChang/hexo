---
title: 樹屋魚主人(aquaponics)
tags: robot
---

# 樹屋魚主人(1)-水族部分

![](http://3.bp.blogspot.com/-etOTuP47Huo/UVhRlTN44sI/AAAAAAAAAus/rFWZoxO95wc/s1600/533545_4085203660907_1610678027_n.jpg)

此次的目標為先架設出一個可以養魚的魚缸

為了達到魚菜共生和專題規模的目的，必須選擇相對於一般市面上還要小一些的魚缸，以便於在短時間內可以進行測試和控制。

下面這邊列有三項重點

*   設備
*   魚種
*   架設

關於設備我找了下列幾個東西

*   設備：
    *   魚缸
        *   塑膠(壓克力)：耐壓不耐刮
        *   玻璃
    *   過濾器
        *   依外型分類
            *   沉水馬達、又稱之水妖精(放水中打氣泡).
            *   上部過濾器：增加更多過濾盒則被稱之為「滴流式過濾器」。優點是過濾效果好，可以隨著魚的數量而增加過濾盒，缺點為不美觀和占空間，且不適合養水草，需要購買馬達。
            *   底部過濾(上面鋪底沙過濾用)
            *   外部過濾器
            *   圓筒(類似RO滲透壓過濾的東西)，內藏氣泵，不須另外購買馬達，優點為容易隱藏，較美觀。
            *   外掛(就掛在魚缸外面循環).
            *   投入式：水妖精，優點是便宜加上好設置。

*   依過濾方式分類
    *   物理性過濾：利用孔洞大小的方式分離雜物
    *   生物性過濾：利用陶瓷環或是生化棉中的硝化菌來化解氨

*   燈
*   底砂
*   其他
    *   溫度計
    *   水冷機
    *   加溫棒
    *   PH檢測器
    *   藥水(除藻.水草肥料.甲基藍)
    *   清潔用具(吸水.小魚網.刮刀)
    *   養水草用具(二氧化碳缸瓶之類)
    *   繁殖/隔離/飼育盒/治療盒

*   魚種：
    *   淡水觀賞魚
        *   孔雀魚類、燈科魚類、金魚錦鋰、短鯛魚類、鬥魚迷鰓、鼠魚異型、三湖慈鯛
        *   美洲慈鯛、神仙七彩、羅漢世界、魟魚科類、娃娃狗頭、龍魚品系、大型古代

*   架設：

1.  缸體設備準備：魚缸目前準備購買約150~300之間的價格，使用外掛過濾器或是水妖精看是否有需要購買馬達。
2.  水質曝氣：準備好的自來水，在魚缸的水循環中運作五天，去除水中的氯氣。可使用煮開過的水，但是也得再加入些沒煮過的水，以避免水中沒有任何礦物質。
3.  建立硝化系統：真正開始養魚之前，得先養細菌，細菌分成兩種

*   硝化菌(好氧菌)
*   厭氧菌

硝化菌(好氧菌)：

在水中會有魚的排泄物和餵食過多而剩餘的殘餌，其主要成分即是氨，這是一種對於魚缸內的生物有害的物質，因此必須藉由消化菌來分解這些有害物質，硝化菌藉由硝化作用將氨轉變為仍然具有毒性的亞硝酸鹽，再將亞硝酸鹽轉變為毒性相當低的硝酸鹽，讓生物遠離生命的威脅，而此一作用稱為硝化作用（氨（NH3）→亞硝酸（NO2）→硝酸鹽（NO3）），由於硝化菌在此階段會消耗缸中的氧氣，經過硝化作用後的產物即是硝酸鹽，雖然毒性沒那麼強，水草的生長還需要硝酸鹽當作肥料，但是只要在濃度五十ppm以上，水中過多的營養就很有可能造成藻類橫生的現象，並可能造成生物生長的遲緩。所以，我們除了在魚缸中培養硝化菌之外，也要培養厭氧菌，讓其進行所謂的＂脫氮作用＂。

參考資料：

[希望部落](http://wish.app01.com/archives/tag/%E9%A4%8A%E9%AD%9A)

[熊的網誌生活 魚缸爆缸-養魚教學](http://www.wretch.cc/blog/PsSamuel/14053724)

[94愛玩水族世界](http://www.earthday.com.tw/thread-2414-1-1.html)

[想養魚嗎? 菜鳥新手入門-器材篇](http://www.mobile01.com/topicdetail.php?f=290&t=358489)



# 樹屋魚主人(2)-焦電紅外線感測器
=================

這次使用了一種新的模組，人體紅外線感測器

![](http://4.bp.blogspot.com/-ZCC2JPxJfWo/UMAPwi-swEI/AAAAAAAAAS8/-KdYECxeh-k/s1600/2012-12-06+11.19.11.jpg)

人體紅外線感測器和一般的紅外線感測器有什麼不同呢？我們先從紅外線感測器的類別來說，總共分成兩大類，一種是熱感測器，一種是光量子感測器，紅外線＂光量子感測器＂的特性是高靈敏，響應快，原理是利用光電效應。紅外線＂熱感測器＂的特性是低靈敏，波長的解析度不高，其中以利用焦電效應的居多，而我們所使用的人體紅外線感測器就是屬於焦電紅外線感測器，又俗稱Passive Infrared Sensor(PIR)，因為他並沒有主動發出紅外光源，而是需要被動的去接受人體的紅外光，因此是屬於被動性的紅外線感測器。

什麼是焦電效應pyroelectric effect(在wiki上面稱之為熱電效應)？

焦電效應是利用溫度變化，直接產生電壓變化。

而焦電效應又分成三種

*   塞貝克效應(Seebeck effect)

兩種不同金屬構成的迴路中，如果兩種金屬的結點處溫度不同，該迴路中就會產生一個溫差電動勢。

*   帕爾帖效應(Peltier effect)

在兩種金屬迴路中加入電源產生電勢後，不同金屬的接觸點會有一個溫差。

*   湯姆森效應(Thomson effect)

當一根金屬棒的兩端溫度不同時，金屬棒兩端會形成電勢差。

焦電紅外線感測器有一個嚴重的問題，就是感測距離太近，因此我們需要在外面安裝一凸透鏡的殼子，利用凸透鏡光線凝聚的原理，來提升感測範圍，為了避免可見光的感擾，一般會選擇使用高密度PE材質的外殼(高密度PE，就是高密度聚乙烯，在薄膜狀態下可視為透明物體，但是在塊狀時由於內部的晶體，而導致光散射，因此呈現不透明)。對於任何發熱的物體(有溫度存在的物體)，都會釋放紅外線，而人體的紅外線波峰約在9~10um，而焦電紅外線感測器的波長靈敏度約在0.2~20um，因此在焦電紅外線感測器上面還加上了一片濾鏡，只允許7~10um的紅外光經過，因此這就是特製的人體紅外線感測器。  
人體紅外線的波峰是怎麼計算出來的呢？則是利用黑體輻射的維恩位移定律

波長最大值 =  維因位移常數b/絕對溫度T

b 為比例常數，稱為維恩位移常數，數值等於2.897E–3 m K

假設人的體溫約在35~37之間，則在此範圍內的最大波長數值，約在9.4~9.31微米之間。

大致總結一下這模組的一般用途，因為他的精確度不是那麼高，一般我們會拿來當作開關使用，目前最常見的就是在廁所內或是在居家的大門口處放置，一旦有人經過，就會開啟電燈。

參考資料：  
[光學機構設計](http://tw.myblog.yahoo.com/omdesigner/article?mid=102)  
[維恩位移定律](http://zh.wikipedia.org/wiki/%E7%BB%B4%E6%81%A9%E4%BD%8D%E7%A7%BB%E5%AE%9A%E5%BE%8B)  
[黑體 (物理學)](http://zh.wikipedia.org/zh-tw/%E9%BB%91%E4%BD%93_(%E7%89%A9%E7%90%86%E5%AD%A6))  
[熱電效應(wiki中文)](http://zh.wikipedia.org/wiki/%E7%86%B1%E9%9B%BB%E6%95%88%E6%87%89)  
[熱電效應(wiki英文)](http://en.wikipedia.org/wiki/Pyroelectricity)  
[邱小新的單晶片日記](http://jyhshin3.blogspot.tw/2009/04/blog-post_22.html)

Posted on [April 7, 2013](http://192.168.1.233/2013/04/07/%e6%a8%b9%e5%b1%8b%e9%ad%9a%e4%b8%bb%e4%ba%ba%e8%a8%88%e7%95%ab2-%e7%84%a6%e9%9b%bb%e7%b4%85%e5%a4%96%e7%b7%9a%e6%84%9f%e6%b8%ac%e5%99%a8/)Author [WilliamChang](http://192.168.1.233/author/williamchang/)Categories [Uncategorized](http://192.168.1.233/category/uncategorized/) [Edit](http://192.168.1.233/wp-admin/post.php?post=248&action=edit)


# 樹屋魚主人(3)-定期記錄
=============

這專題開始於十月左右，是由於系上開設的機電整合專題而製作， 在2012/12/15的時候我們已經將繼電器開關和四個裝置連接上了。

\[http://www.youtube.com/watch?v=cgezV1laNHc\]

這四個裝置分別為

1.  沉水馬達：抽水給植物澆花使用
2.  加熱棒：溫度太低的時候給熱帶魚溫暖
3.  LED燈條：人靠近的時候會發光
4.  氣泵：如果氧氣太少會適時補充氧氣

在影片裡面，我將程式設定成每隔一秒鐘即依序切換不同的裝置，你會看到有四個裝置依序啟動，不過因為加熱棒是增加溫度，所以你並無法用眼睛來觀察到。

\[http://www.youtube.com/watch?v=BPhjzfL5RBY\]

這是2012.12.16的日誌，雖然此時此刻應該趕著寫學士論文初稿，但是由於昨天(週六)從清大回來之後，突然有豐富的靈感，因此就趕快進行房子的製作。

樹屋魚主人的設計概念：

一大早來到辦公室，就能看見小魚在水藍色的魚缸裡面優游自在中午到了，氣泵開始打氣，水車運轉著，讓魚有新鮮的空氣和午餐可以吃下午到了，取下幾片檸檬香蜂草葉片來泡茶，據說有位活到108歲的英國貴族最愛喝這種茶了

晚上到了，人離開之後，魚缸也隨之將LED關掉，減少電源浪費。

假日到了，擔心植物沒有人澆水，可能會死掉，不過不用擔心，具有自動澆水功能  
這套系統裝配了

1.  arduino 主板
2.  I2C LCD模組
3.  I2C RTC時鐘模組
4.  水中溫度計
5.  蜂鳴器
6.  水位計
7.  LED燈條
8.  氣泵
9.  加熱棒
10.  沉水馬達
11.  繼電器模組
12.  藍芽模組
13.  伺服馬達(餵食器)
14.  人體紅外線模組
15.  土壤感測器

裝置分配如下

*   裝置1234

由Arduino做為控制板，將RTC的時間和水中溫度計讀取並由LCD顯示

*   裝置56

如果水位計過低，則啟動蜂鳴器，提醒使用者加水

*   裝置789 10 11

LED燈條的電壓為12V(車用)，氣泵為魚缸專用的氣泵拆除下來，使用3~5V，沉水馬達和加熱棒則是使用110VAC的電源，為了不破壞產品本身而另外製作了轉換線連接到繼電器上面

*   裝置12

除了自動控制的部分，如果使用者希望可以自動啟動裝置，我們則寫好了部分的藍芽手機連線的程式碼，希望可以藉由這樣來操作Arduino

*   裝置13

因為系上先前有上過生物產業的相關課程，其中有播種機的介紹，因此利用播種機的原理製作出飼料機(因為播種的概念則就是將種子一顆顆分別播種或是分成一次定量的播種，利用這樣的方式恰好和飼料機有異曲同工之妙。)

*   裝置14

人體紅外線模組，當人們一靠近魚缸的時候，就會啟動LED燈條，因為其實只有人在看魚的時候需要燈光，當人一走開的時候就會關閉魚缸的燈光。

*   裝置15

土壤感測器，這邊是利用水會導電的概念來製作，利用水導電的程度來簡單觀測水份含量  
程式概念：

分成手動和自動

*   手動部分：

利用現在最流行的智慧型手機，進行藍芽連線之後，搭配專用APP則可以操控

*   自動部分：

1.  時間和溫度隨時觀測
2.  水位計一旦發現水位過低即啟動蜂鳴器
3.  人靠近魚缸時候會開啟LED燈
4.  由土壤感測器觀測到的水含量過低時會自動澆水。
5.  氣泵則是每天中午會啟動1分鐘
6.  由溫度計所測量的溫度低於26度時則啟動加溫至28度，維持水溫約在2度C之間
7.  餵食器則是上午十點和下午五點餵食一次(伺服馬達轉一圈)

Posted on [April 7, 2013](http://192.168.1.233/2013/04/07/%e6%a8%b9%e5%b1%8b%e9%ad%9a%e4%b8%bb%e4%ba%ba%e8%a8%88%e7%95%ab3-%e5%ae%9a%e6%9c%9f%e8%a8%98%e9%8c%84/)Author [WilliamChang](http://192.168.1.233/author/williamchang/)Categories [Uncategorized](http://192.168.1.233/category/uncategorized/) [Edit](http://192.168.1.233/wp-admin/post.php?post=231&action=edit)

# 樹屋魚主人(4)-KICKSTARTER相關分享
========================

![](http://2.bp.blogspot.com/-ynWIVARYN-Q/UVhRgxqgkLI/AAAAAAAAAuk/60RiArn-L7o/s1600/e6be36b616b7f3c8e08a7c3b8c18546f_large.jpg)

[http://www.kickstarter.com/projects/2142509221/home-aquaponics-kit-self-cleaning-fish-tank-that-g](http://www.kickstarter.com/projects/2142509221/home-aquaponics-kit-self-cleaning-fish-tank-that-g)

接下來介紹的這兩份和我類似的魚菜共生系統，他們的展示都在[Kickstarter](http://www.kickstarter.com/)這個網路贊助平台上面。

以下是另外一款的魚菜共生系統

![](https://s3.amazonaws.com/ksr/assets/000/297/243/ee8279b623c0f33e83499fea74327086_large.jpg?1354933398)

[http://www.kickstarter.com/projects/thegoldfishgarden/the-goldfish-garden-self-cleaning-aquaponic-aquari](http://www.kickstarter.com/projects/thegoldfishgarden/the-goldfish-garden-self-cleaning-aquaponic-aquari)

大家對於魚菜共生都有許多種的創意和想法，甚至在製作專題的過程中會發現，大家的創意和想法都不約而同有許多相似的部分，或許在這世界的潮流之下，大家所看見的世界越來越接近了呢(燦笑)。

Posted on [April 7, 2013](http://192.168.1.233/2013/04/07/%e6%a8%b9%e5%b1%8b%e9%ad%9a%e4%b8%bb%e4%ba%ba%e8%a8%88%e7%95%ab4-kickstarter%e7%9b%b8%e9%97%9c%e5%88%86%e4%ba%ab/)Author [WilliamChang](http://192.168.1.233/author/williamchang/)Categories [Uncategorized](http://192.168.1.233/category/uncategorized/) [Edit](http://192.168.1.233/wp-admin/post.php?post=241&action=edit)


# 樹屋魚主人(5)-RTC時鐘模組
================

[![2012-12-3017-32-22](http://www.tabbymeow.com/wp-content/uploads/2013/04/2012-12-3017-32-22.jpg)](http://www.tabbymeow.com/wp-content/uploads/2013/04/2012-12-3017-32-22.jpg)

為了可以具有顯示時間的功能，以及能夠每天定時啟動某些裝置，因此我們得Arduino有辦法顯示時間。一開始從Arduino Cookbook裡面找到有一整個章節都在介紹這個功能，上面寫著利用Arduino本身就可以製作鬧鐘。

在Arduino站台裡面有關於Time的程式碼可以用

[http://playground.arduino.cc/Code/Time](http://playground.arduino.cc/Code/Time)

以下是下載網址

[http://www.arduino.cc/playground/uploads/Code/Time.zip](http://www.arduino.cc/playground/uploads/Code/Time.zip)而安裝好了之後，開啟TimeAlarmExample.pde

    /*
     * TimeAlarmExample.pde
     *
     * This example calls alarm functions at 8:30 am and at 5:45 pm (17:45)
     * and simulates turning lights on at night and off in the morning
     * A weekly timer is set for Saturdays at 8:30:30
     *
     * A timer is called every 15 seconds
     * Another timer is called once only after 10 seconds
     *
     * At startup the time is set to Jan 1 2011  8:29 am
     */
    
    #include <Time.h>
    #include <TimeAlarms.h>
    
    void setup()
    {
      Serial.begin(9600);
      setTime(8,29,0,1,1,11); // set time to Saturday 8:29:00am Jan 1 2011
      // create the alarms 
      Alarm.alarmRepeat(8,30,0, MorningAlarm);  // 8:30am every day
      Alarm.alarmRepeat(17,45,0,EveningAlarm);  // 5:45pm every day 
      Alarm.alarmRepeat(dowSaturday,8,30,30,WeeklyAlarm);  // 8:30:30 every Saturday 
    
      Alarm.timerRepeat(15, Repeats);            // timer for every 15 seconds    
      Alarm.timerOnce(10, OnceOnly);             // called once after 10 seconds 
    }
    
    void  loop(){  
      digitalClockDisplay();
      Alarm.delay(1000); // wait one second between clock display
    }
    
    // functions to be called when an alarm triggers:
    void MorningAlarm(){
      Serial.println("Alarm: - turn lights off");    
    }
    
    void EveningAlarm(){
      Serial.println("Alarm: - turn lights on");           
    }
    
    void WeeklyAlarm(){
      Serial.println("Alarm: - its Monday Morning");      
    }
    
    void ExplicitAlarm(){
      Serial.println("Alarm: - this triggers only at the given date and time");       
    }
    
    void Repeats(){
      Serial.println("15 second timer");         
    }
    
    void OnceOnly(){
      Serial.println("This timer only triggers once");  
    }
    
    void digitalClockDisplay()
    {
      // digital clock display of the time
      Serial.print(hour());
      printDigits(minute());
      printDigits(second());
      Serial.println(); 
    }
    
    void printDigits(int digits)
    {
      Serial.print(":");
      if(digits < 10)
        Serial.print('0');
      Serial.print(digits);
    }
    

然而這個pde有一個缺點，也就是使用的過程中如果Arduino因為某些原因斷電或是Reset，那麼時間就會回復到setTime的時間，因此這將會造成我們不少困擾，所以後來選購RTC時鐘模組來使用。  
RTC (Real-time clock, RTC)

實時時鐘，他是一個小裝置，電腦裡面也會安裝，如果有拆開電腦看過的人就會知道，主機板上面都會安裝一個小電池，那就是用來維持RTC時間計時使用的，因為在主要電源斷電後，電腦本身就無法計算時間了，但是如果有RTC利用水銀電池持具計算時間的話，那麼在下次電腦開機的時候，時間就會是正確的時間，如果當RTC裡面的水銀電池被拆除或是沒有電量的話，那麼在電腦關機之後，時間就會錯置。

而我購買的RTC所使用的晶片是DS1307，是低耗能的BCD時間日期模組，利用I2C的方式傳遞資料，他能夠給的時間資料有”秒”、”分”、”小時”、”天”、”日期”、”月份”和”年”，而且還能夠進進行閏年(Leap year)的轉換，並且調整每月的30/31天數，其電路還有自動切換主電源和電池電源的功能。

DS1307的datasheet

[http://datasheets.maximintegrated.com/en/ds/DS1307.pdf](http://datasheets.maximintegrated.com/en/ds/DS1307.pdf)

由於Arduino實在是太多人使用了，因此很順利地找到有人寫好的範例可以直接使用

[http://www.ladyada.net/learn/breakoutplus/ds1307rtc.html](http://www.ladyada.net/learn/breakoutplus/ds1307rtc.html)

首先要下載檔案，並且安裝到Arduino的Library檔案夾之下

[https://github.com/adafruit/RTClib](https://github.com/adafruit/RTClib)

點開example>>RTClib>>ds1307程式碼

    #include <Wire.h>
    #include "RTClib.h"
    
    RTC_DS1307 RTC;
    
    void setup () {
        Serial.begin(57600);
        Wire.begin();
        RTC.begin();
    
      if (! RTC.isrunning()) {
        Serial.println("RTC is NOT running!");
        // 關鍵：
        //下列程式碼會將現在電腦時間寫入，如果有需要調整RTC內的時間，要將此行註解取消
        //RTC.adjust(DateTime(__DATE__, __TIME__));
      }
    }
    
    void loop () {
        DateTime now = RTC.now();        
        Serial.print(now.year(), DEC);
        Serial.print('/');
        Serial.print(now.month(), DEC);
        Serial.print('/');
        Serial.print(now.day(), DEC);
        Serial.print(' ');
        Serial.print(now.hour(), DEC);
        Serial.print(':');
        Serial.print(now.minute(), DEC);
        Serial.print(':');
        Serial.print(now.second(), DEC);
        Serial.println();
    
        Serial.print(" since midnight 1/1/1970 = ");
        Serial.print(now.unixtime());
        Serial.print("s = ");
        Serial.print(now.unixtime() / 86400L);
        Serial.println("d");
    
        // calculate a date which is 7 days and 30 seconds into the future
        DateTime future (now.unixtime() + 7 * 86400L + 30);
    
        Serial.print(" now + 7d + 30s: ");
        Serial.print(future.year(), DEC);
        Serial.print('/');
        Serial.print(future.month(), DEC);
        Serial.print('/');
        Serial.print(future.day(), DEC);
        Serial.print(' ');
        Serial.print(future.hour(), DEC);
        Serial.print(':');
        Serial.print(future.minute(), DEC);
        Serial.print(':');
        Serial.print(future.second(), DEC);
        Serial.println();
    
        Serial.println();
        delay(3000);
    }
    

大致上直接點開就可以執行了，裡面有一個比較重要的事情要說，也就是下列這行程式碼。

    RTC.adjust(DateTime(__DATE__, __TIME__));
    

這行的功用在於調整RTC內部的時間，當我們在compile的時候就會將此刻電腦的時間同時寫入這行程式碼，因此在此之後就得趕快把compile的程式趕快燒進去Arduino裡面，不然時間會相差很多，在第一次寫入之後，就可以將這行程式碼註解掉了，因為之後RTC裡面就會不斷地計算時間，就不需要我們再一次的修改時間。

在此之後，即使電源突然斷電，或是被Reset也沒關係了，接下來我將會利用RTC模組所產生的時間搭配TimeAlarmExample.pde改寫出一份程式碼，就可以有準確的時間和定時啟動裝置的功能囉。

    #include <Time.h>
    #include <TimeAlarms.h>
    #include <Wire.h>
    #include "RTClib.h"
    
    RTC_DS1307 RTC;
    
    void setup()
    {
        Serial.begin(9600);
        Wire.begin();
        RTC.begin();
        if (! RTC.isrunning()) 
        {
            Serial.println("RTC is NOT running!");
            //下列這行將會設定RTC時間為電腦Compile的當前時間。
            //RTC.adjust(DateTime(__DATE__, __TIME__));
        }
    
        DateTime now = RTC.now();
        //將RTC的時間設定給AlarmClockTime使用
        setTime(now.hour(),now.minute(),second(),now.day(),now.month(),now.year()); 
    
        // 創造時鐘 
        Alarm.alarmRepeat(8,30,0, MorningAlarm);  
        Alarm.alarmRepeat(dowSaturday,8,30,30,WeeklyAlarm);  
        Alarm.timerRepeat(15, Repeats);          
        Alarm.timerOnce(10, OnceOnly);          
    }
    
    void  loop(){  
        digitalClockDisplay();
        Alarm.delay(1000);
    }
    // functions to be called when an alarm triggers:
    void MorningAlarm(){
        Serial.println("Alarm: - turn lights off");    
    }
    void WeeklyAlarm(){
        Serial.println("Alarm: - its Monday Morning");      
    }
    void Repeats(){
        Serial.println("15 second timer");         
    }
    void OnceOnly(){
        Serial.println("This timer only triggers once");  
    }
    //顯示目前時間
    void digitalClockDisplay()
    {
        // digital clock display of the time
        Serial.print(hour());
        printDigits(minute());
        printDigits(second());
        Serial.println(); 
    }
    //如果顯示0~9的話，前面會加一個0
    void printDigits(int digits)
    {
        Serial.print(":");
        if(digits < 10)
        Serial.print('0');
        Serial.print(digits);
    }
    
    

可是當程式碼一開始compile的時候將會出現問題，好像是RTClib和Time互相衝突，因此我把RTC裡面有出現問題的程式碼直接註解

RTC.h(第17行)

        uint8_t dayOfWeek() const;
    

RTC.cpp(第113~116行)

    uint8_t DateTime::dayOfWeek() const {    
        uint16_t day = date2days(yOff, m, d);
        return (day + 6) % 7; // Jan 1, 2000 is a Saturday, i.e. returns 6
    }
    

到了最後這邊來總結一下，利用RTC模組取得正確時間，再利用Time Library所提供的鬧鐘功能，因此我們就可以藉由這樣的方式來控制我們想要的裝置，在希望的時間執行我們需要的功能，像是我的餵食器就可以每天中午給魚們吃午餐囉~~

Posted on [April 7, 2013](http://192.168.1.233/2013/04/07/%e6%a8%b9%e5%b1%8b%e9%ad%9a%e4%b8%bb%e4%ba%ba%e8%a8%88%e7%95%ab5-rtc%e6%99%82%e9%90%98%e6%a8%a1%e7%b5%84/)Author [WilliamChang](http://192.168.1.233/author/williamchang/)Categories [Uncategorized](http://192.168.1.233/category/uncategorized/) [Edit](http://192.168.1.233/wp-admin/post.php?post=257&action=edit)

# 樹屋魚主人(6)-LCD-I2C模組
==================

![](http://4.bp.blogspot.com/-k-elZ_rDx6U/UVhNUidishI/AAAAAAAAAt8/N34Y5wJ9xKk/s1600/400px-1602I2C_1.jpg)

由於最後我們的作品希望可以展示時間和各種需要顯示的狀態，因此決定安裝一塊LCD模組，不過剛剛有提到過，我們有許多各種需要顯示的東西，因此表示我們的Arduino UNO已經沒有辦法再提供豐富的腳位給我們的LCD使用。

在Cooper Maa大大中的一篇文中＂[Arduino 筆記 – Lab9 在 2×16 LCD 上顯示 “Hello World” 訊息](http://coopermaa2nd.blogspot.tw/2010/12/arduino-lab9-2x16-lcd-world.html)＂，我們可以知道即使使用了最少IO port的做法，也得要有四條data線、RS暫存器選擇線和E致能線，加上電源兩條，總共就得消耗八條線路，其中六條還是用去了digital，以UNO來說，幾乎用去了大半，這樣一來我可能得再購買一塊arduino分別控制LCD和其他裝置，這是相當不方便的，不僅要花錢還得另外進行兩塊UNO的連線，否則就是要購買mega來使用。

(內心：………..但是我沒這麼多錢，而且我懶………….我就是只有一塊UNO，究竟有沒有辦法不要佔去這麼多digital腳位，又可以讓我使用需要很多腳位的LCD呢?)

碰巧被我找到這麼一塊好東西，這樣一來我連一根digital腳位都沒有消耗，搭配RTC模組使用，甚至可以說，我一根腳位都沒有浪費的使用，那就是I2C模組拉QWQ!!!!!(QWQ，這是一種網路表情符號，表示很感動的意思。)  
本篇最一開始就是LCD I2C模組的圖片

[http://www.geeetech.com/wiki/index.php/Serial\_I2C\_1602\_16%C3%972\_Character\_LCD\_Module](http://www.geeetech.com/wiki/index.php/Serial_I2C_1602_16%C3%972_Character_LCD_Module)  
不過外觀看起來和一般的LCD沒什麼太多的不同，唯一有不同的就是多插了一塊小IC晶片PCF8574，他是I2C的8bits擴充IC，利用他就可以將Arduino的腳位擴充，或許將來的專題我可以使用它來做許多多腳位的裝置。

PCF8574的data sheet

[http://www.datasheetcatalog.org/datasheet2/b/0fjjhr6h643gldhx3o1rgkyk7ucy.pdf](http://www.datasheetcatalog.org/datasheet2/b/0fjjhr6h643gldhx3o1rgkyk7ucy.pdf)

關於PCF8574有個專業的教學網站在說明這塊IC怎麼使用

[http://garagelab.com/profiles/blogs/tutorial-arduino-i-o-port-expander-with-pcf8574](http://garagelab.com/profiles/blogs/tutorial-arduino-i-o-port-expander-with-pcf8574)

他還提到怎麼應用在一般的LCD上面，使一般的LCD也變成I2C的LCD模組

[http://garagelab.com/profiles/blogs/tutorial-lcd-using-only-2-arduino-pins-with-pcf8574-and-i2c](http://garagelab.com/profiles/blogs/tutorial-lcd-using-only-2-arduino-pins-with-pcf8574-and-i2c)  
接下來這邊來說說實作方式  
在剛剛的網站裡面有下載檔案，我將下載網址連過來。

[http://www.geeetech.com/wiki/index.php/Serial\_I2C\_1602\_16%C3%972\_Character\_LCD\_Module](http://www.geeetech.com/wiki/index.php/Serial_I2C_1602_16%C3%972_Character_LCD_Module)

總共分成0023和1.0版本可以使用

[Arduino IDE 023](http://www.geeetech.com/Documents/LiquidCrystal_I2C.rar)

[Arduino IDE 1.0](http://www.geeetech.com/Documents/LiquidCrystal_I2Cv1-1.rar)  
開啟之後可以稍微看看範例檔案，下列的程式我有稍微修改過。

    #include <Wire.h> 
    #include <LiquidCrystal_I2C.h>
    // 0x27是LCD模組的地址，16表示有十六欄位，2表示總共有2欄
    LiquidCrystal_I2C lcd(0x27,16,2);  
    void setup()
    {
        //LCD初始化
        lcd.init();   
        lcd.init();
        //開啟背光
        lcd.backlight();
        //清除先前畫面
        lcd.clear();
        //設定第一個字顯示座標
        lcd.setCursor(0,0);
        //顯示字串
        lcd.print("Hello, world!");
    }
    void loop()
    {
    }
    

在導入.h檔和定義好LCD I2C之後，在setup那邊需要初始化LCD和開啟背板光源，之後只要設定座標和使用lcd.print即可顯示我們想要顯示的資料，用起來實在是相當的方便，以後只要Serial.print可以顯示，LCD上面一樣可以顯示。

舉例來說，我將Arduino的第一個基礎範例analogReadSerial來進行修改。

    #include <Wire.h> 
    #include <LiquidCrystal_I2C.h>
    LiquidCrystal_I2C lcd(0x27,16,2);
    void setup() {
      Serial.begin(9600);
      lcd.init();   // initialize the lcd 
      lcd.init();
      // Print a message to the LCD.
      lcd.backlight();
      lcd.clear();
    }
    
    void loop() {
      int sensorValue = analogRead(A0);
      lcd.setCursor(0,0);
      lcd.println(sensorValue, DEC);
    }
    

我將該設定的部分設定好之後，把Serial.println換成lcd.print即可顯示。

這東西實在是太方便了～～～～

不過雖然Arduino的模組們用起來很方便，但是等到會用了之後，還是建議大家回到最初使用LCD的方式玩看看，才能夠真正的了解為什麼可以用兩隻腳就可以操控LCD是一件多麼讓人感動的事情，而且也可以同時了解四位元和八位元的意義是什麼，這樣回過頭來去尋找源頭的過程中，就像是考古學家一樣，會發現許多前人留下的有趣故事唷。

Posted on [April 7, 2013](http://192.168.1.233/2013/04/07/%e6%a8%b9%e5%b1%8b%e9%ad%9a%e4%b8%bb%e4%ba%ba6-lcd-i2c%e6%a8%a1%e7%b5%84/)Author [WilliamChang](http://192.168.1.233/author/williamchang/)Categories [Uncategorized](http://192.168.1.233/category/uncategorized/) [Edit](http://192.168.1.233/wp-admin/post.php?post=261&action=edit)

# 樹屋魚主人(7)-DS18B20溫度計
===================

[![2012-12-30_2141241](http://www.tabbymeow.com/wp-content/uploads/2013/04/2012-12-30_2141241.jpg)](http://www.tabbymeow.com/wp-content/uploads/2013/04/2012-12-30_2141241.jpg)

接著來介紹這次使用的溫度計~~~

話說這次用的的溫度計讓我大驚奇啊!!!!!!!!!

發現新種類的通訊協定!!!!!!(對我來說算是新的XD，以前沒有用過)

這個新通訊協定稱之為Dallas Semiconductor’s 1-Wire Protocol，他和I2C還有SPI一樣有可以接很多顆同型裝置的優點，更棒的事情是他只需要一條訊號線和一條地線。

不過在這篇主要是介紹我的溫度感測器DS18B20。

為了在Arduino上面使用這個溫度感測器，我們先到Arduino官網上面下載OneWire的Library

[http://playground.arduino.cc/Learning/OneWire](http://playground.arduino.cc/Learning/OneWire)

    #include <OneWire.h>
    OneWire  ds(11);
      byte i;
      byte present = 0;    
      byte data[12];
      byte addr[8];
      float celsius;
    void setup(void) {
      Serial.begin(9600);
    }
    void loop(void) {
      if ( !ds.search(addr)) {
        ds.reset_search();
        delay(250);
        return;
      }
      ds.reset();
      ds.select(addr);
      ds.write(0x44,1);      
      delay(750); 
      present = ds.reset();
      ds.select(addr);    
      ds.write(0xBE);      
      for ( i = 0; i < 9; i++) {     
        data[i] = ds.read();
      }
      unsigned int raw = (data[1] << 8) | data[0];
      celsius = (float)raw / 16.0;
      Serial.print("  Temperature = ");
      Serial.print(celsius);
      Serial.println(" Celsius");
    
    }
    

由於這感測器的原理和通訊協定我還沒弄很通，等之後稍微了解再和大家分享囉，如果你有購買這DS18B20的話，這篇的資料或許對你有些幫助。

Posted on [April 7, 2013](http://192.168.1.233/2013/04/07/%e6%a8%b9%e5%b1%8b%e9%ad%9a%e4%b8%bb%e4%ba%ba7-ds18b20%e6%ba%ab%e5%ba%a6%e8%a8%88/)Author [WilliamChang](http://192.168.1.233/author/williamchang/)Categories [Uncategorized](http://192.168.1.233/category/uncategorized/) [Edit](http://192.168.1.233/wp-admin/post.php?post=290&action=edit)

